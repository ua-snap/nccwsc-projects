<div class="container-fluid">
  <app-breadcrumb></app-breadcrumb>

  <h2>Topic: {{ page_title }}</h2>

  <div class="row topic">
    <div class="col-md-2">
      <div class="select-box">
        <h3 class="select-title">CASC</h3>
        <div *ngFor="let csc of cscs">
          <mat-checkbox
            type="checkbox"
            (change)="changeCurrentCASC($event)"
            [checked]="current_csc.indexOf(csc) != -1"
            [value]="csc"
            [id]="csc"
            name="csc"
          >
            {{ csc.replace(" CASC", "") }}</mat-checkbox
          >
        </div>
      </div>
      <div class="select-box">
        <h3 class="select-title">Subtopic</h3>
        <div *ngFor="let subtopic of subtopics">
          <mat-checkbox
            type="checkbox"
            (change)="changeCurrentSubTopic($event)"
            [checked]="current_subtopic.indexOf(subtopic) != -1"
            [value]="subtopic"
            [id]="subtopic"
            name="subtopic"
          >
            {{ subtopic }}</mat-checkbox
          >
        </div>
      </div>
      <div class="select-box">
        <h3 class="select-title">Status</h3>
        <div *ngFor="let status of statuses">
          <mat-checkbox
            type="checkbox"
            (change)="changeCurrentStatus($event)"
            [checked]="current_status.indexOf(status) != -1"
            [value]="status"
            [id]="status"
            name="status"
          >
            {{ status }}</mat-checkbox
          >
        </div>
      </div>
      <div class="select-box">
        <h3 class="select-title">Year</h3>
        <div *ngFor="let fy of fiscal_years">
          <mat-checkbox
            type="checkbox"
            (change)="changeCurrentYear($event)"
            [checked]="current_fy.indexOf(fy) != -1"
            [value]="fy"
            [id]="fy"
            name="fy"
          >
            {{ fy }}</mat-checkbox
          >
        </div>
      </div>
    </div>

    <div class="col-md-10 results-table">
      <div *ngIf="dataLoading">
        <h4 class="loading">
          <img
            src="{{ approot }}assets/loading.gif"
            class="loading"
            alt="Loading Results"
            title="Loading Results"
          />Loading {{ title }} ScienceBase projects&hellip;
        </h4>
      </div>

      <div
        class="no_data"
        *ngIf="filteredProjectsList.length == 0 && dataLoading == false"
      >
        <h4 class="no_data">
          No projects match all the search filters selected.
        </h4>
        <p>Remove one or more filters to see matching projects.</p>
      </div>

      <div *ngIf="!dataLoading && filteredProjectsList.length > 0">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          class="mat-elevation-z8"
        >
          <!-- Column Definitions -->
          <ng-container matColumnDef="fiscal_year">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Year</th>
            <td mat-cell *matCellDef="let project">
              {{ project.fiscal_year }}
            </td>
          </ng-container>

          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="title">
              Title
            </th>
            <td mat-cell *matCellDef="let project" class="title">
              <a [routerLink]="['/project/', project.csc.id, project.id]">{{
                project.title
              }}</a>
            </td>
          </ng-container>

          <ng-container matColumnDef="csc_name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>CASC</th>
            <td mat-cell *matCellDef="let project">
              {{ project.csc_name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="subtopics_formatted">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              Subtopic(s)
            </th>
            <td
              mat-cell
              *matCellDef="let project"
              [innerHTML]="project.subtopics_formatted"
            ></td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let project">
              {{ project.status }}
            </td>
          </ng-container>

          <!-- Row Definitions -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </div>
  </div>
</div>
